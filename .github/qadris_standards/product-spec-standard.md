# QadrisCorp — Product Specification Standard

Version: 1.1  
Last Updated: 2025-12-25  
Scope: AI 協作產生產品規格文件的標準

---

## 1. 概述

`product_spec.md` 是 AI 協作開發流程中的核心文件，用於在實作前定義產品的完整規格。此文件由使用者與 AI 共同討論產生，作為後續開發的藍圖。

---

## 2. 文件用途

| 階段 | 用途 |
|------|------|
| 討論階段 | 釐清需求、定義範圍 |
| 設計階段 | 確定技術架構、資料流 |
| 實作階段 | AI agent 依此文件產生程式碼 |
| 驗收階段 | 確認實作是否符合規格 |

---

## 3. 討論前的必要確認

> ⚠️ **重要**：在開始撰寫 product_spec.md 之前，Copilot **必須**先詢問以下問題

### 3.1 內部資源使用確認

Copilot 應主動詢問使用者：

```
在開始撰寫 product_spec.md 之前，請先確認：

📦 **是否需要使用公司內部資源？**

1. 資料擷取：
   - [ ] MeasureRetriever（財務指標）
   - [ ] QadrisWebAPI（內部 API）
   - [ ] DataRetriever（通用資料擷取框架）
   - [ ] 直接存取資料庫
   - [ ] 不使用內部資料來源

2. 內部工具：
   - [ ] QadrisFactorBase（因子計算框架）
   - [ ] QadrisUtils（通用工具）
   - [ ] 其他內部 Repo：___________
   - [ ] 不使用內部工具

3. 基礎設施：
   - [ ] 需要部署到公司主機
   - [ ] 需要存取內部資料庫
   - [ ] 需要使用 Redis 快取
   - [ ] 本地開發/獨立運行即可

請回覆您的選擇，我會據此調整 product_spec.md 的內容。
```

### 3.2 根據回應處理

| 使用者回應 | 處理方式 |
|------------|----------|
| 使用內部資源 | 閱讀 `qadris_resources/internal-repos.md`，在 spec 中明確註明使用哪些資源 |
| 不使用內部資源 | 在 spec 中註明「本專案不依賴內部資源」 |
| 不確定 | 介紹可用的內部資源，協助使用者決定 |

---

## 4. 文件結構（必要區塊）

### 4.1 基本資訊

```markdown
# {專案名稱} — Product Specification

Version: {版本號}  
Created: {建立日期}  
Last Updated: {最後更新日期}  
Status: Draft / Review / Approved
```

### 4.2 必要章節

| 章節 | 說明 | 必填 |
|------|------|------|
| **1. 專案概要** | 一句話描述、目標、非目標 | ✅ |
| **2. 使用者故事** | 主要使用情境 | ✅ |
| **3. 功能需求** | 詳細功能列表 | ✅ |
| **4. 技術架構** | 技術選型、資料流 | ✅ |
| **5. 資料模型** | 資料結構定義 | ✅ |
| **6. 內部資源依賴** | 使用的內部 Repo/API/DB | ✅ ⚠️ 新增 |
| **7. API 設計** | 介面規格（如適用） | 選填 |
| **8. 非功能需求** | 效能、安全性等 | 選填 |
| **9. 里程碑** | 開發階段規劃 | ✅ |

### 4.3 內部資源依賴章節格式

```markdown
## 6. 內部資源依賴

### 6.1 使用的內部 Repositories

| Repo | 用途 | 必要性 |
|------|------|--------|
| MeasureRetriever | 擷取財務指標 | 必要 |
| QadrisFactorBase | 因子計算框架 | 必要 |

### 6.2 使用的內部 API

| API | 端點 | 用途 |
|-----|------|------|
| QadrisWebAPI | /api/v1/prices | 取得價格資料 |

### 6.3 資料庫依賴

| 資料庫 | 資料表 | 用途 | 權限 |
|--------|--------|------|------|
| qadris_main | prices | 讀取價格資料 | 唯讀 |

### 6.4 不使用內部資源（如適用）

> ⚠️ 本專案**不依賴**任何公司內部資源，可獨立運行。
```

---

## 5. 文件位置與模板

### 5.1 存放位置

👉 **標準存放路徑**：`{專案根目錄}/doc/product_spec.md`

所有專案的 `product_spec.md` 統一存放於專案的 `doc/` 目錄下。

### 5.2 模板

👉 **模板位置**：`qadris_templates/product-spec-template.md`

使用時直接複製模板檔案至專案的 `doc/` 目錄，並填入相關內容。

---

## 6. 撰寫指引

### 6.1 Copilot 協助產生 product_spec.md 時

1. **先詢問內部資源**：依 Section 3 詢問是否使用內部資源
2. **主動提問**：針對模糊需求主動詢問使用者
3. **建議技術**：根據需求建議適合的技術選型
4. **識別風險**：提出潛在的技術風險與挑戰
5. **迭代更新**：討論過程中持續更新文件

### 6.2 必須確認的事項

- [ ] 是否使用內部資源？（**必須明確記錄**）
- [ ] 專案目標是否明確？
- [ ] 非目標是否列出？（避免範圍蔓延）
- [ ] 技術選型是否與公司現有架構相容？
- [ ] 是否有依賴其他專案？
- [ ] 里程碑是否合理？

### 6.3 禁止事項

- ❌ 跳過內部資源確認直接產生 spec
- ❌ 跳過討論直接產生完整 spec
- ❌ 使用公司未採用的技術框架（除非有充分理由）
- ❌ 忽略非功能需求
- ❌ 未註明內部資源使用狀況

---

## 7. 與其他文件的關係

```
product_spec.md（含內部資源依賴）
    ↓ 實作完成後
copilot-instructions.md (完整版)
    ↓ 根據實作產生
README.md
```

---

## 8. 範例參考

完整範例請參考：
- `meeting/meeting_YYYYMMDD_project_X/` 目錄下的討論紀錄

---

## Changelog

- 1.1 — 2025-12-25: 新增「討論前的必要確認」(Section 3)，要求明確記錄內部資源使用狀況
- 1.0 — 2025-12-24: 初版建立
