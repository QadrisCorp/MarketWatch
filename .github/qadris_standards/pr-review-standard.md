# PR 與變更審查標準

Version: 1.1  
Last Updated: 2025-12-25  
Scope: 所有 QadrisCorp repo 的 PR 提交與變更審查規範

---

## 1. 初版架構審查（First Version Review）

> ⚠️ **重要**：當 AI Agent 完成初版實作後，必須進行架構審查，確認符合設計規格。

### 1.1 審查時機

初版架構審查應在以下時間點進行：
- AI Agent 完成第一版可運行程式碼後
- 提交正式 PR 之前
- 產生完整版 README.md 與 copilot-instructions.md 之前

### 1.2 架構審查 Checklist

| 審查項目 | 對照文件 | 說明 |
|----------|----------|------|
| 目錄結構 | `architecture-standard.md` | 是否符合專案類型的標準結構 |
| 分層架構 | `architecture-standard.md` | 是否遵守相依性規則 |
| 命名規範 | `architecture-standard.md` | 模組/類別/函數命名是否一致 |
| 功能完整性 | `product_spec.md` | 是否實作所有必要功能 |
| 技術選型 | `product_spec.md` | 是否使用指定的技術棧 |
| 資料流 | `product_spec.md` | 資料流是否符合設計 |

### 1.3 程式碼品質審查

```
檢查項目：
- [ ] 進入點明確（main.py / run.py / app.py）
- [ ] 無循環依賴
- [ ] Config 管理正確（敏感資訊使用環境變數）
- [ ] 有適當的錯誤處理
- [ ] 有基本的 logging
- [ ] 有 type hints（建議）
- [ ] 有 docstrings（公開介面必要）
```

### 1.4 與 Product Spec 對照

| 對照項目 | 通過條件 |
|----------|----------|
| 功能需求 | 所有 P0 功能已實作 |
| 使用者故事 | 主要流程可運行 |
| 技術架構 | 使用指定的框架與技術 |
| 資料模型 | 欄位與型別正確 |
| API 設計 | 端點與參數符合規格 |

### 1.5 初版審查結果處理

| 結果 | 處理方式 |
|------|----------|
| ✅ 通過 | 進入測試驗證階段 |
| ⚠️ 小問題 | 記錄 Issues，繼續進行測試 |
| ❌ 重大偏差 | 退回修正，重新審查 |

---

## 2. README.md 更新規範

> **重要**：README.md 是部門主管與協作者了解專案的首要入口，必須保持與程式碼同步。

### 2.1 README 模板

所有新建專案應使用 `.github/qadris_templates/README_TEMPLATE.md` 作為起始模板，確保文件結構一致。

### 2.2 強制更新情境

以下變更**必須**在同一個 PR 中更新 README.md，否則 Reviewer 應退回：

| 變更類型 | 需更新 README 的區塊 |
|----------|---------------------|
| 新增模組/類別 | 專案架構、功能特色 |
| 變更 API 介面 | API 文件、使用範例 |
| 新增/移除依賴 | 安裝與環境設定 |
| 變更專案結構 | 專案架構 |
| 新增主要功能 | 功能特色、使用範例 |
| 變更安裝/設定方式 | 安裝與環境設定、快速開始 |
| 變更相依專案關係 | 相依專案 |

### 2.3 README 品質要求

README.md 必須包含：
- **一句話摘要**：清楚說明專案用途（會在公司會議報表中呈現）
- **專案架構**：目錄結構說明
- **安裝步驟**：可照著操作的完整步驟
- **使用範例**：可執行的程式碼範例
- **相依專案**：與其他 QadrisCorp 專案的關係

---

## 3. 測試驗證（Test Validation）

> ⚠️ **重要**：初版架構審查通過後，必須進行測試驗證才能提交正式 PR。

### 3.1 測試驗證時機

```
初版架構審查 ──✅通過──→ 測試驗證 ──✅通過──→ 提交 PR
```

### 3.2 測試驗證 Checklist

| 驗證項目 | 通過條件 | 參考文件 |
|----------|----------|----------|
| 測試目錄存在 | `/tests` 目錄已建立 | `testing-standard.md` |
| 測試檔案命名 | `test_{模組名}.py` 格式 | `testing-standard.md` |
| 單元測試 | 核心功能有對應測試 | `testing-standard.md` |
| 錯誤處理測試 | 邊界條件有測試覆蓋 | `testing-standard.md` |
| Mock 使用 | 外部依賴已 mock | `testing-standard.md` |
| 測試通過 | `pytest` 執行無失敗 | — |

### 3.3 最低測試要求

| 專案類型 | 最低測試要求 |
|----------|-------------|
| Python Package | 核心模組的單元測試 |
| API Service | API 端點的整合測試 |
| CLI Tool | 主要命令的功能測試 |
| Data Pipeline | 資料轉換邏輯的單元測試 |

### 3.4 測試執行指令

```bash
# 執行所有測試
pytest

# 顯示詳細輸出
pytest -v

# 產生覆蓋率報告（建議）
pytest --cov=src --cov-report=term-missing
```

### 3.5 測試驗證結果處理

| 結果 | 處理方式 |
|------|----------|
| ✅ 全部通過 | 可提交 PR |
| ⚠️ 部分失敗 | 修復後重新執行 |
| ❌ 無測試 | 補充測試後再提交 |

---

## 4. PR 提交時的文件檢查

每次程式碼或架構變更開 PR 時，必須檢視以下文件是否**需要**同步更新（不需要時可略過，但 Reviewer 應確認）：

### 4.1 必檢文件清單

1. **README.md** — 專案說明、安裝步驟、使用範例  
2. **requirements.txt** — Python 依賴套件清單  
3. **docs/** — 文件目錄下的所有使用指南與 API 文件  
4. **.github/copilot-instructions.md** — 專案 Copilot 規範  

### 4.2 變更類型對應

若 PR 涉及下列變更，原則上應在**同一個 PR 中**更新對應文件：

| 變更類型 | 需檢查並可能需更新的文件 |
|----------|--------------------------|
| 新增模組/類別 | README.md（架構）、docs/（使用指南） |
| 新增依賴套件 | requirements.txt |
| 變更 API 介面 | README.md（範例）、docs/（API 文件） |
| 變更專案結構 | README.md（目錄結構）、copilot-instructions.md |
| 新增功能 | README.md（功能說明）、docs/（使用指南） |

---

## 5. 發佈前的文件總體檢（Release Review）

在發佈版本（tag/release）前，需進行一次文件總體檢：

### 5.1 檢查項目

1. 確認 **Changelog / 版本號** 與實際變更一致  
2. 確認 **README.md** 已反映主要功能與使用方式  
3. 確認 **docs/** 已涵蓋此次發佈的新功能與重要行為變更  
4. 如有影響協作方式，更新 **.github/copilot-instructions.md** 與相關流程文件  

### 5.2 補救措施

發佈前若發現文件與實作有落差，應補一個針對「文件與說明」的小 PR 修正。

---

## 6. PR 審查 Checklist

Reviewer 在審查 PR 時，應確認以下項目：

- [ ] 程式碼變更是否有對應的文件更新
- [ ] README.md 是否與實際功能同步
- [ ] 新增依賴是否已更新 requirements.txt
- [ ] API 變更是否有更新範例與文件
- [ ] 專案結構變更是否有更新架構說明
- [ ] 測試是否通過（初版需有基本測試）

---

## 7. AI Agent 協助

當 Copilot 協助提交 PR 時，應：

1. 自動檢查是否有需要更新的文件
2. 提醒使用者遺漏的文件更新
3. 依照 `.github/PULL_REQUEST_TEMPLATE.md` 格式產生 PR 內容
4. 確認測試已執行並通過

---

## Changelog

- 1.1 — 2025-12-25: 新增初版架構審查（Section 1）與測試驗證（Section 3）
- 1.0 — 初版建立
